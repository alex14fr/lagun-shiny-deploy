This server runs multiple apps:<p>

<a href=https://gitlab.com/drti/lagun>Lagun</a> with the following changes (see files in lagun-mod/):
  <ul>
  <li> don't use renv; all dependencies are at their latest version on CRAN
  <li> send keepalive messages on the websocket every 140 s
  <li> replace fOptions package for quasi-random sequences
  </ul>
  <p>
an R terminal in apps/terminal: 
  <ul>
  <li> uses <a href=https://tsl0922.github.io/ttyd/>ttyd</a> and provides you with an R terminal on the web
  <li> if needed use system("sh") to go to a shell prompt.
  <li> it supports sending/receiving files via ZMODEM (use 
system("lrz"), resp. system("lsz <file>") at the R prompt to receive/send files 
from your browser). Use it to import your R code/data and 
export your plots and computation results. Only /tmp is writable, and this
directory lives no more than 25 hours (change this in entry_multi and src/cleanfiles.c if you want).
  <li> No network access is permitted in this app (so no install.packages 
from CRAN other than the preinstalled packages).
  <li> Each terminal session runs in a separate container. Files are separated between sessions. If you don't want this, there is a "shared_files_terminal" applications in apps/ that you can run by removing the "off" file in its directory. In this shared mode, even the pseudo tty files are readable and writable.
  <li> The launcher for this app is in apps/terminal/launch0, it calls utility programs in src/dropcap-inner.c and src/dropcap-outer.c for setting up the namespaces, filesystem layout and capabilities.
  <li> R integrated help is stripped to save space; you are supposed to have an online browser anyway.
  </ul>
Each app is run in a separate container; it consists of an R process (or 
ttyd process) listening on a Unix domain socket. <p>
    An HTTP frontend server (source in src/relayttpd.c) dispatches 
requests from outside TCP connections to these Unix sockets, depending on the 
leading directory of the requested URL. The correspondance between leading 
directories and Unix sockets is given on the command line (see variable args in 
entry_multi).<p>
    This server also serves a static HTML page (in /tmp/index.html, 
generated by entry_multi) as home page, and supports cacheing of the homepages 
of each app (src/httpget.c, triggered by entry_multi, is used to populate this 
cache, in plain and gzip encoding variants). Some apps may not support it, it can
be disabled by leaving a file named "no_home_cache" in the app directory.
</ul>

To run this server on your premises (Linux only), you may download the prebuilt x86_64 rootfs file at <a href=https://janona.perso.math.cnrs.fr/shiny-rootfs.tar.xz>shiny-rootfs.tar.xz</a>, then use<p>

<pre>
$ tar xf shiny-rootfs.tar.xz
$ doas cp -a /dev/*random /dev/ptmx rootfs/dev/
$ ./99_enter_pivotroot /entry_multi # or use your favorite container runtime
</pre>

or use the included Dockerfile.<p>

You can customize the apps in the "/apps" directory of the rootfs. A template "testapp" is included, remove the "off" file to get it run.

The rootfs can also be built with<p>

<pre>
# create the <a href=https://alpinelinux.org>Alpine Linux</a> build chroot
$ ./01_mkbuild
# build R and required R packages
$ ./02_build
# extract files in distroless rootfs
$ ./03_mkroot
</pre>

root privileges are required to create some special nodes in /dev/
(the scripts will use doas to do this, run them as normal user).<p>

The build is not made in a safe container (no pivot_root/umount, no capability 
drop, no seccomp, no IPC/network isolation...), don't run it as privilegied 
user.<p>

Dependencies for the build: Linux kernel with namespaces (mount, user, PID), usual utilities 
(including unshare(1)), git, rsync, opendoas (or sudo symlinked to doas).<p>

<a href=https://github.com/alex14fr/lagun-shiny-deploy>Main source repository</a><p>
Author : <a href="mailto:alexandre[.]janon[at]u-psud[.]fr">Alexandre Janon</a>



